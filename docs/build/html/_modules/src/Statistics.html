<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>src.Statistics &mdash; LCBD Analytical Tools v0.0.3b documentation</title><link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> LCBD Analytical Tools
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">LCBD Analytical Tools</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
      <li>src.Statistics</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for src.Statistics</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="c1"># INTRACLASS CORRELATION COEFFICIENT</span>
<span class="c1"># ===================================</span>

<span class="c1"># https://stats.stackexchange.com/questions/63368/</span>
<span class="c1"># intra-class-correlation-and-experimental-design</span>

<div class="viewcode-block" id="unordered_pearson"><a class="viewcode-back" href="../../src.html#src.Statistics.unordered_pearson">[docs]</a><span class="k">def</span> <span class="nf">unordered_pearson</span><span class="p">(</span><span class="n">Y</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The assessment of correlation via the familiar Pearson product-moment</span>
<span class="sd">    procedure applies only to those situations where one particular member of a</span>
<span class="sd">    bivariate pair of measures unequivocally belongs to the X variable and the</span>
<span class="sd">    other unequivocally belongs to the Y variable.</span>

<span class="sd">    When it is entirely arbitrary which of the items within the pair is listed</span>
<span class="sd">    first and which is listed second.</span>

<span class="sd">    :param Y: N x X matrix (rows = raters, columns = measurements)</span>
<span class="sd">    :type Y: numpy.array</span>


<span class="sd">    &quot;&quot;&quot;</span></div>


<span class="c1"># def simple_icc(</span>
<span class="c1">#     X,</span>
<span class="c1">#     Y,</span>
<span class="c1">#     icc_type=&#39;ICC1&#39;):</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     Computes the intraclass correlation coefficient via Pingouin</span>
<span class="c1">#     of a given 2 equally-sized arrays. The expectation at build</span>
<span class="c1">#     is that they are linear time-series.</span>
<span class="c1">#</span>
<span class="c1">#     :param X: TimeSeries</span>
<span class="c1">#     :type X: TimeSeries.TimeSeries</span>
<span class="c1">#     :param Y: TimeSeries</span>
<span class="c1">#     :type Y: TimeSeries.TimeSeries</span>
<span class="c1">#     :param icc_type: one of {ICC1, ICC2, ICC3, ICC1k, ICC2k, ICC3k}</span>
<span class="c1">#     :type icc_type: str</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     import pingouin as pg</span>
<span class="c1">#     import pandas as pd</span>
<span class="c1">#</span>
<span class="c1">#     df1 = pd.DataFrame(X.signal, columns=[&#39;rating&#39;])</span>
<span class="c1">#     df1[&#39;participant&#39;] = X.meta[&#39;participant&#39;]</span>
<span class="c1">#     df1[&#39;time&#39;] = X.time</span>
<span class="c1">#</span>
<span class="c1">#     df2 = pd.DataFrame(Y.signal, columns=[&#39;rating&#39;])</span>
<span class="c1">#     df2[&#39;participant&#39;] = Y.meta[&#39;participant&#39;]</span>
<span class="c1">#     df2[&#39;time&#39;] = Y.time</span>
<span class="c1">#</span>
<span class="c1">#     df3 = pd.concat([df1, df2])</span>
<span class="c1">#</span>
<span class="c1">#     icc = pg.intraclass_corr(</span>
<span class="c1">#         data=df3,</span>
<span class="c1">#         targets=&#39;time&#39;,</span>
<span class="c1">#         raters=&#39;participant&#39;,</span>
<span class="c1">#         ratings=&#39;rating&#39;)</span>
<span class="c1">#</span>
<span class="c1">#     icc.set_index(&quot;Type&quot;)</span>
<span class="c1">#</span>
<span class="c1">#     return icc</span>

<div class="viewcode-block" id="ping_icc"><a class="viewcode-back" href="../../src.html#src.Statistics.ping_icc">[docs]</a><span class="k">def</span> <span class="nf">ping_icc</span><span class="p">(</span>
    <span class="n">dX</span><span class="p">,</span>
    <span class="n">icc_type</span><span class="o">=</span><span class="s1">&#39;ICC1&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the intraclass correlation coefficient via Pingouin</span>
<span class="sd">    of a given 2 equally-sized arrays. The expectation at build</span>
<span class="sd">    is that they are linear time-series.</span>

<span class="sd">    :param dX: list of TimeSeries.TimeSeries objects for which the</span>
<span class="sd">        icc will be calculated</span>
<span class="sd">    :type dX: list of TimeSeries.TimeSeries</span>
<span class="sd">    :param icc_type: one of {ICC1, ICC2, ICC3, ICC1k, ICC2k, ICC3k}</span>
<span class="sd">    :type icc_type: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">pingouin</span> <span class="k">as</span> <span class="nn">pg</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="n">dX</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">signal</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;rating&#39;</span><span class="p">])</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;participant&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;participant&#39;</span><span class="p">]</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">time</span>
        <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">)</span>

    <span class="n">icc</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">intraclass_corr</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
        <span class="n">targets</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span>
        <span class="n">raters</span><span class="o">=</span><span class="s1">&#39;participant&#39;</span><span class="p">,</span>
        <span class="n">ratings</span><span class="o">=</span><span class="s1">&#39;rating&#39;</span><span class="p">,</span>
<span class="c1">#         nan_policy=&#39;omit&#39;</span>
    <span class="p">)</span>

    <span class="n">icc</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;Type&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">icc</span></div>

<div class="viewcode-block" id="icc"><a class="viewcode-back" href="../../src.html#src.Statistics.icc">[docs]</a><span class="k">def</span> <span class="nf">icc</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">icc_type</span><span class="o">=</span><span class="s1">&#39;ICC(3,k)&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate intraclass correlation coefficient</span>

<span class="sd">    ICC Formulas are based on:</span>
<span class="sd">    Shrout, P. E., &amp; Fleiss, J. L. (1979). Intraclass correlations: uses in</span>
<span class="sd">    assessing rater reliability. Psychological bulletin, 86(2), 420.</span>
<span class="sd">    icc1:  x_ij = mu + beta_j + w_ij</span>
<span class="sd">    icc2/3:  x_ij = mu + alpha_i + beta_j + (ab)_ij + epsilon_ij</span>
<span class="sd">    Code modifed from nipype algorithms.icc</span>
<span class="sd">    https://github.com/nipy/nipype/blob/master/nipype/algorithms/icc.py</span>

<span class="sd">    :param Y: N x X matrix (rows = raters, columns = measurements)</span>
<span class="sd">    :type Y: numpy.array</span>
<span class="sd">    :param icc_type: type of ICC to calculate, one of: {ICC(2,1), ICC(2, k),</span>
<span class="sd">        ICC(3, 1), ICC(3, k)}</span>
<span class="sd">    :type icc_type: str</span>

<span class="sd">    :return: ICC (numpy.array) intraclass correlation coefficient</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">ones</span><span class="p">,</span> <span class="n">kron</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">eye</span><span class="p">,</span> <span class="n">hstack</span><span class="p">,</span> <span class="n">dot</span><span class="p">,</span> <span class="n">tile</span>
    <span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">pinv</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="c1"># Degrees of Freedom</span>
    <span class="n">dfc</span> <span class="o">=</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">dfr</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="c1"># if dfc == 0:</span>
    <span class="c1">#     dfc = 1</span>
    <span class="c1"># if dfr == 0:</span>
    <span class="c1">#     dfr = 1</span>

    <span class="n">dfe</span> <span class="o">=</span> <span class="n">dfc</span> <span class="o">*</span> <span class="n">dfr</span>

    <span class="c1"># Sum Square Total</span>
    <span class="n">mean_Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
    <span class="n">SST</span> <span class="o">=</span> <span class="p">((</span><span class="n">Y</span> <span class="o">-</span> <span class="n">mean_Y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="c1"># create the design matrix for the different levels</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>  <span class="c1"># sessions</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># subjects</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">])</span>

    <span class="c1"># Sum Square Error</span>
    <span class="n">predicted_Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">X</span><span class="p">))),</span>
                                <span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="n">Y</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">))</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="n">predicted_Y</span>
    <span class="n">SSE</span> <span class="o">=</span> <span class="p">(</span><span class="n">residuals</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="n">MSE</span> <span class="o">=</span> <span class="n">SSE</span> <span class="o">/</span> <span class="n">dfe</span>

    <span class="c1"># Sum square column effect - between columns</span>
    <span class="n">SSC</span> <span class="o">=</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">mean_Y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">*</span> <span class="n">n</span>
    <span class="n">MSC</span> <span class="o">=</span> <span class="n">SSC</span> <span class="o">/</span> <span class="n">dfc</span>  <span class="c1"># / n (without n in SPSS results)</span>

    <span class="c1"># Sum Square subject effect - between rows/subjects</span>
    <span class="n">SSR</span> <span class="o">=</span> <span class="n">SST</span> <span class="o">-</span> <span class="n">SSC</span> <span class="o">-</span> <span class="n">SSE</span>
    <span class="n">MSR</span> <span class="o">=</span> <span class="n">SSR</span> <span class="o">/</span> <span class="n">dfr</span>

    <span class="k">if</span> <span class="n">icc_type</span> <span class="o">==</span> <span class="s1">&#39;icc1&#39;</span><span class="p">:</span>
        <span class="c1"># ICC(2,1) = (mean square subject - mean square error) /</span>
        <span class="c1"># (mean square subject + (k-1)*mean square error +</span>
        <span class="c1"># k*(mean square columns - mean square error)/n)</span>
        <span class="c1"># ICC = (MSR - MSRW) / (MSR + (k-1) * MSRW)</span>
        <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;This method isn&#39;t implemented yet.&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">icc_type</span> <span class="o">==</span> <span class="s1">&#39;ICC(2,1)&#39;</span> <span class="ow">or</span> <span class="n">icc_type</span> <span class="o">==</span> <span class="s1">&#39;ICC(2,k)&#39;</span><span class="p">:</span>
        <span class="c1"># ICC(2,1) = (mean square subject - mean square error) /</span>
        <span class="c1"># (mean square subject + (k-1)*mean square error +</span>
        <span class="c1"># k*(mean square columns - mean square error)/n)</span>
        <span class="k">if</span> <span class="n">icc_type</span> <span class="o">==</span> <span class="s1">&#39;ICC(2,k)&#39;</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">ICC</span> <span class="o">=</span> <span class="p">(</span><span class="n">MSR</span> <span class="o">-</span> <span class="n">MSE</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">MSR</span> <span class="o">+</span> <span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">MSE</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="n">MSC</span> <span class="o">-</span> <span class="n">MSE</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">icc_type</span> <span class="o">==</span> <span class="s1">&#39;ICC(3,1)&#39;</span> <span class="ow">or</span> <span class="n">icc_type</span> <span class="o">==</span> <span class="s1">&#39;ICC(3,k)&#39;</span><span class="p">:</span>
        <span class="c1"># ICC(3,1) = (mean square subject - mean square error) /</span>
        <span class="c1"># (mean square subject + (k-1)*mean square error)</span>
        <span class="k">if</span> <span class="n">icc_type</span> <span class="o">==</span> <span class="s1">&#39;ICC(3,k)&#39;</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">ICC</span> <span class="o">=</span> <span class="p">(</span><span class="n">MSR</span> <span class="o">-</span> <span class="n">MSE</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">MSR</span> <span class="o">+</span> <span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">MSE</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ICC</span></div>

<span class="c1"># def simple_icc(Y):</span>
<span class="c1">#     s2 = (1 / (2 * Y.shape[0])) * (np.sum([</span>
<span class="c1">#         ((Y[rater] - np.mean(Y))**2) for rater in Y]) +\</span>
<span class="c1">#         np.sum()</span>
<span class="c1">#     ])</span>
<span class="c1">#     r = (1 / (3 * Y.shape[0] * ))</span>

<span class="c1"># INTER-RATER RELIABILITY METHODS</span>
<span class="c1"># =================================</span>
<span class="c1"># https://www.statisticshowto.com/inter-rater-reliability/</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Clayton Schneider.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>